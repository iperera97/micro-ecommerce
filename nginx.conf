upstream auth-service {                                                                                                                                                                                          server 0.0.0.0:8000;                                                                                                                                                                                         }                                                                                                                                                                                                                                                                                                                                                                                                                             upstream products-service {                                                                                                                                                                                      server 0.0.0.0:6000;                                                                                                                                                                                         }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            server {                                                                                                                                                                                                           listen 80 default_server;                                                                                                                                                                                      include mime.types;                                                                                                                                                                                            root /var/www/html;                                                                                                                                                                                                                                                                                                                                                                                                           location /api/auth {                                                                                                                                                                                               proxy_pass http://auth-service;                                                                                                                                                                            }                                                                                                                                                                                                                                                                                                                                                                                                                             location /api/products {                                                                                                                                                                                           auth_request /_oauth2_token_introspection;                                                                                                                                                                     auth_request_set $jwt_token $sent_http_jwt;                                                                                                                                                                    proxy_set_header JWT $jwt_token;                                                                                                                                                                               proxy_pass http://products-service;                                                                                                                                                                        }                                                                                                                                                                                                                                                                                                                                                                                                                             location /_oauth2_token_introspection {                                                                                                                                                                            internal;                                                                                                                                                                                                      proxy_method      GET;                                                                                                                                                                                         proxy_set_header  Authorization "$http_authorization";                                                                                                                                                         proxy_set_header  Content-Type "application/json";                                                                                                                                                             proxy_pass        http://auth-service/api/auth/user-jwt/;                                                                                                                                                  }                                                                                                                                                                                                          }    upstream auth-service {
  server 0.0.0.0:8000;
}

upstream products-service {
  server 0.0.0.0:6000;
}


server {
    listen 80 default_server;
    include mime.types;
    root /var/www/html;

    location /api/auth {
        proxy_pass http://auth-service;
    }

    location /api/products {
        auth_request /_oauth2_token_introspection;
        auth_request_set $jwt_token $sent_http_jwt;
        proxy_set_header JWT $jwt_token;
        proxy_pass http://products-service;
    }

    location /_oauth2_token_introspection {
        internal;
        proxy_method      GET;
        proxy_set_header  Authorization "$http_authorization";
        proxy_set_header  Content-Type "application/json";
        proxy_pass        http://auth-service/api/auth/user-jwt/;
    }
}